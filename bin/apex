#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require_relative '../lib/apex'

class App
  include Methadone::Main
  include Methadone::CLILogging

  main do |needed, maybe|
    puts options[:switch]
    puts options[:flag]
    Apex::main
  end

  description "APEX reference implementation for the APEX protocol."
  version Apex::VERSION

  # Proxy to an OptionParser instance's on method
  on("--[no]-switch", "Toggles the switch")
  on("--flag VALUE", "Sets the flag.")

  arg :needed
  arg :maybe, :optional

  defaults_from_env_var 'SOME_VAR'
  defaults_from_config_file '.apex.rc'

  use_log_level_option :toggle_debug_on_signal => 'USR1'

  go!
end
